<!DOCTYPE html>
<html>
<head>
  <title>Sistema de Pastas Hier√°rquico</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-storage-compat.js"></script>
  <style>
    .folder { margin: 10px; padding: 10px; border: 1px solid #ddd; cursor: pointer; }
    .files { margin-left: 30px; display: none; }
    .file { margin: 5px; padding: 5px; }
    .active { background-color: #f0f0f0; }
  </style>
</head>
<body>
  <h1>Sistema de Pastas</h1>
  
  <!-- Criar pastas -->
  <div>
    <input type="text" id="folderName" placeholder="Nome da pasta">
    <button onclick="createFolder()">Criar Pasta</button>
  </div>

  <!-- Upload para pasta -->
  <div>
    <select id="selectedFolder">
      <option value="">Selecione uma pasta</option>
    </select>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Enviar Arquivo</button>
  </div>

  <!-- Listagem de pastas -->
  <div id="foldersContainer"></div>

  <script>
 const firebaseConfig = {
  apiKey: "AIzaSyDFw39E7f8TQPNlDVKrj5861_FMG_YqCy4",
  authDomain: "finance-ef792.firebaseapp.com",
  databaseURL: "https://finance-ef792-default-rtdb.firebaseio.com",
  projectId: "finance-ef792",
  storageBucket: "finance-ef792.firebasestorage.app",
  messagingSenderId: "67228742612",
  appId: "1:67228742612:web:fa2480d939bda6f18f1c41"
};
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    // Criar pasta
    function createFolder() {
      const folderName = document.getElementById('folderName').value.trim();
      if (!folderName) return;

      database.ref('folders').push({
        name: folderName,
        created: firebase.database.ServerValue.TIMESTAMP
      });
      document.getElementById('folderName').value = '';
    }

    // Upload de arquivo
    async function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      const folderId = document.getElementById('selectedFolder').value;
      
      if (!file || !folderId) {
        alert('Selecione um arquivo e uma pasta!');
        return;
      }

      try {
        const folderSnapshot = await database.ref(`folders/${folderId}`).once('value');
        const folderName = folderSnapshot.val().name;

        // Upload do arquivo
        const storageRef = storage.ref(`folders/${folderId}/${file.name}`);
        await storageRef.put(file);
        const downloadURL = await storageRef.getDownloadURL();

        // Salvar metadados
        await database.ref(`folders/${folderId}/files`).push().set({
          name: file.name,
          url: downloadURL,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });

        alert('Arquivo enviado!');
      } catch (error) {
        console.error('Erro:', error);
        alert('Erro no upload!');
      }
    }

    // Gerenciar exibi√ß√£o de pastas
    function setupFolders() {
      const foldersRef = database.ref('folders');
      
      // Atualizar dropdown
      foldersRef.on('value', (snapshot) => {
        const select = document.getElementById('selectedFolder');
        select.innerHTML = '<option value="">Selecione uma pasta</option>';
        snapshot.forEach((child) => {
          const option = document.createElement('option');
          option.value = child.key;
          option.textContent = child.val().name;
          select.appendChild(option);
        });
      });

      // Listar pastas
      foldersRef.on('child_added', (child) => {
        const folder = child.val();
        const folderId = child.key;
        
        // Criar elemento da pasta
        const folderDiv = document.createElement('div');
        folderDiv.className = 'folder';
        folderDiv.innerHTML = `
          <div class="folder-header" onclick="toggleFolder('${folderId}')">
            üìÅ ${folder.name}
          </div>
          <div class="files" id="files-${folderId}"></div>
        `;

        document.getElementById('foldersContainer').appendChild(folderDiv);
      });
    }

    // Alternar exibi√ß√£o de arquivos
    async function toggleFolder(folderId) {
      const filesContainer = document.getElementById(`files-${folderId}`);
      const folderHeader = document.querySelector(`[onclick="toggleFolder('${folderId}')"]`);

      // Alternar visualiza√ß√£o
      filesContainer.style.display = filesContainer.style.display === 'none' ? 'block' : 'none';
      folderHeader.classList.toggle('active');

      // Carregar arquivos apenas na primeira vez
      if (filesContainer.children.length === 0) {
        const filesRef = database.ref(`folders/${folderId}/files`);
        
        filesRef.on('child_added', (snapshot) => {
          const file = snapshot.val();
          const fileElement = document.createElement('div');
          fileElement.className = 'file';
          fileElement.innerHTML = `
            üìÑ ${file.name}
            <a href="${file.url}" download style="margin-left: 10px;">Download</a>
          `;
          filesContainer.appendChild(fileElement);
        });
      }
    }

    // Inicializa√ß√£o
    window.onload = () => {
      setupFolders();
    };
  </script>
</body>
</html>
