<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor Financeiro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --positive-color: #27ae60;
            --negative-color: #e74c3c;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
        }

        .container {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 1rem;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .category-sidebar {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            height: fit-content;
        }

        .financial-grid {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .balance-chart {
            margin-top: 2rem;
            background: white;
            border-radius: 8px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            min-width: 600px;
        }

        th, td {
            padding: 0.75rem;
            text-align: right;
            border: 1px solid #dee2e6;
            min-width: 120px;
        }

        .running-balance {
            font-weight: bold;
            background-color: #f8f9fa;
        }

        .positive { color: var(--positive-color); }
        .negative { color: var(--negative-color); }

        .category-management button {
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="number"] {
            width: 100%;
            text-align: right;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 14px;
        }

        #categoryModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 400px;
        }

        #categoryModal input,
        #categoryModal select {
            width: 100%;
            margin: 0.5rem 0;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #categoryModal button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            width: 48%;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                padding: 0.5rem;
            }

            .category-sidebar {
                order: -1;
                position: sticky;
                top: 0;
                z-index: 1;
            }

            table {
                font-size: 13px;
            }

            th, td {
                padding: 0.5rem;
            }

            .balance-chart {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="category-sidebar">
            <div class="category-management">
                <h3>Categorias</h3>
                <button onclick="showAddCategoryModal()">+ Nova Categoria</button>
                <div id="categoryList"></div>
            </div>
        </div>

        <div class="financial-grid">
            <table id="financialTable">
                <thead id="tableHeader"></thead>
                <tbody id="tableBody"></tbody>
                <tfoot id="tableFooter"></tfoot>
            </table>
            <div class="balance-chart">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>
    </div>

    <div id="categoryModal">
        <h3>Gerenciar Categoria</h3>
        <input type="text" id="categoryName" placeholder="Nome da categoria">
        <select id="categoryType">
            <option value="income">Receita</option>
            <option value="expense">Despesa</option>
        </select>
        <button onclick="saveCategory()">Salvar</button>
        <button onclick="closeModal()">Cancelar</button>
    </div>

<script>
let balanceChart = null;

let state = {
    categories: [],
    months: [],
    transactions: [],
    selectedCategory: null
};

function init() {
    generateMonths();
    loadCategories();
    renderGrid();
}

function generateMonths() {
    const today = new Date();
    state.months = Array.from({ length: 12 }, (_, i) => {
        const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
        return {
            id: date.toISOString(),
            name: date.toLocaleString('default', { month: 'short' }) + ' ' + date.getFullYear().toString().slice(-2),
            isCurrent: i === 0
        };
    });
}

function loadCategories() {
    state.categories = localStorage.getItem('categories') 
        ? JSON.parse(localStorage.getItem('categories'))
        : [
            { 
                id: 1, 
                name: 'Salário', 
                type: 'income', 
                values: Array(12).fill(5000) 
            },
            { 
                id: 2, 
                name: 'Aluguel', 
                type: 'expense', 
                values: Array(12).fill(2000) 
            }
        ];
    
    renderCategoryList();
}

// ... (mantidas as funções showAddCategoryModal, saveCategory, closeModal e renderCategoryList sem alterações) ...

function renderGrid() {
    const header = document.getElementById('tableHeader');
    const body = document.getElementById('tableBody');
    const footer = document.getElementById('tableFooter');

    header.innerHTML = `
        <tr>
            <th>Categoria</th>
            ${state.months.map(m => `<th${m.isCurrent ? ' class="current-month"' : ''}>${m.name}</th>`).join('')}
        </tr>
    `;

    body.innerHTML = state.categories.map(category => `
        <tr>
            <td>${category.name}</td>
            ${category.values.map((value, index) => `
                <td>
                    <input type="number" 
                           value="${value || ''}"
                           onchange="updateValue(${category.id}, ${index}, this.value)"
                           placeholder="0,00"
                           step="0.01">
                </td>
            `).join('')}
        </tr>
    `).join('');

    footer.innerHTML = `
        <tr class="running-balance">
            <td>Saldo Projetado</td>
            ${calculateRunningBalances().map(balance => `
                <td class="${balance >= 0 ? 'positive' : 'negative'}">
                    ${formatCurrency(balance)}
                </td>
            `).join('')}
        </tr>
    `;

    renderBalanceChart();
}

function renderBalanceChart() {
    const ctx = document.getElementById('balanceChart').getContext('2d');
    const balances = calculateRunningBalances();
    const labels = state.months.map(m => m.name);

    if (balanceChart) balanceChart.destroy();

    balanceChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                data: balances,
                borderColor: '#2c3e50',
                backgroundColor: 'rgba(44, 62, 80, 0.05)',
                tension: 0.3,
                borderWidth: 2,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: true,
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return 'Saldo: ' + formatCurrency(context.raw);
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: '#f0f0f0' },
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        },
                        maxTicksLimit: 6
                    }
                },
                x: {
                    grid: { display: false }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
}

// ... (mantidas as demais funções sem alterações) ...
</script>
</body>
</html>
