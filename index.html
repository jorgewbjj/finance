<!DOCTYPE html>
<html>
<head>
    <title>Biblioteca de PDFs</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-section { margin-bottom: 30px; }
        .pdf-list { border-top: 2px solid #ccc; padding-top: 20px; }
        .pdf-item { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px; }
        #pdfContainer { margin-top: 20px; }
    </style>
</head>
<body>
    <!-- Formulário de Upload -->
    <div class="upload-section">
        <h2>Enviar PDF</h2>
        <input type="file" id="pdfInput" accept=".pdf">
        <button onclick="uploadPDF()">Enviar PDF</button>
        <div id="status"></div>
    </div>

    <!-- Lista de PDFs -->
    <div class="pdf-list">
        <h2>Biblioteca de PDFs</h2>
        <div id="pdfContainer"></div>
    </div>

    <!-- Firebase SDK (Versão compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>

    <script>
        // Configuração do Firebase (substitua com seus dados)
      const firebaseConfig = {
  apiKey: "AIzaSyDFw39E7f8TQPNlDVKrj5861_FMG_YqCy4",
  authDomain: "finance-ef792.firebaseapp.com",
  projectId: "finance-ef792",
  storageBucket: "finance-ef792.firebasestorage.app",
  messagingSenderId: "67228742612",
  appId: "1:67228742612:web:fa2480d939bda6f18f1c41"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const database = firebase.database();

        // Função para enviar PDF
        async function uploadPDF() {
            const file = document.getElementById('pdfInput').files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.textContent = "Enviando...";

            try {
                // Upload para o Firebase Storage
                const storageRef = storage.ref(`pdfs/${Date.now()}_${file.name}`);
                const uploadTask = await storageRef.put(file);
                
                // Obter URL do PDF
                const downloadURL = await uploadTask.ref.getDownloadURL();

                // Salvar metadados no Realtime Database
                await database.ref('pdfs').push({
                    name: file.name,
                    url: downloadURL,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });

                status.textContent = "Upload completo!";
            } catch (error) {
                status.textContent = "Erro: " + error.message;
            }
        }

        // Carregar e exibir PDFs (CORRIGIDO)
        function loadPDFs() {
            const pdfContainer = document.getElementById('pdfContainer');
            
            // Limpar lista antes de recarregar
            pdfContainer.innerHTML = "<p>Carregando PDFs...</p>";

            // Ouvir alterações no nó 'pdfs' do banco de dados
            database.ref('pdfs').on('value', (snapshot) => {
                pdfContainer.innerHTML = ""; // Limpar conteúdo anterior

                if (!snapshot.exists()) {
                    pdfContainer.innerHTML = "<p>Nenhum PDF encontrado.</p>";
                    return;
                }

                snapshot.forEach((childSnapshot) => {
                    const pdf = childSnapshot.val();
                    const pdfElement = document.createElement('div');
                    pdfElement.className = 'pdf-item';
                    pdfElement.innerHTML = `
                        <h3>${pdf.name}</h3>
                        <a href="${pdf.url}" target="_blank">Visualizar/Download</a>
                    `;
                    pdfContainer.appendChild(pdfElement);
                });
            }, (error) => {
                console.error("Erro ao carregar PDFs:", error);
                pdfContainer.innerHTML = "<p>Erro ao carregar a biblioteca.</p>";
            });
        }

        // Carregar PDFs ao iniciar
        loadPDFs();
    </script>
</body>
</html>
