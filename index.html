<!DOCTYPE html>
<html>
<head>
    <title>Biblioteca de PDFs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pdf-list {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .pdf-item {
            margin: 15px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #pdfInput {
            margin: 10px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #status {
            margin-top: 10px;
            color: #d9534f;
        }
    </style>
</head>
<body>
    <div class="upload-section">
        <h2>üì§ Enviar PDF</h2>
        <input type="file" id="pdfInput" accept=".pdf">
        <button onclick="uploadPDF()">Enviar PDF</button>
        <div id="status"></div>
    </div>

    <div class="pdf-list">
        <h2>üìö Biblioteca de PDFs</h2>
        <div id="pdfContainer"><p>Carregando...</p></div>
    </div>

    <!-- Firebase SDK v9 (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>

    <script>
        // Configura√ß√£o do Firebase (substitua com seus dados!)
      const firebaseConfig = {
  apiKey: "AIzaSyDFw39E7f8TQPNlDVKrj5861_FMG_YqCy4",
  authDomain: "finance-ef792.firebaseapp.com",
  projectId: "finance-ef792",
  storageBucket: "finance-ef792.firebasestorage.app",
  messagingSenderId: "67228742612",
  appId: "1:67228742612:web:fa2480d939bda6f18f1c41"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const database = firebase.database();

        // Fun√ß√£o de Upload
        async function uploadPDF() {
            const file = document.getElementById('pdfInput').files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.textContent = "‚è≥ Enviando...";

            try {
                // 1. Upload para o Storage
                const fileName = `${Date.now()}_${file.name}`;
                const storageRef = storage.ref(`pdfs/${fileName}`);
                await storageRef.put(file);

                // 2. Obter URL de download
                const downloadURL = await storageRef.getDownloadURL();

                // 3. Salvar metadados no Database
                await database.ref('pdfs').push({
                    name: file.name,
                    url: downloadURL,
                    fileName: fileName,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });

                status.textContent = "‚úÖ Upload conclu√≠do!";
                document.getElementById('pdfInput').value = ""; // Limpa o input
            } catch (error) {
                status.textContent = `‚ùå Erro: ${error.message}`;
                console.error("Detalhes do erro:", error);
            }
        }

        // Fun√ß√£o para Carregar PDFs (Atualizada)
        function loadPDFs() {
            const pdfContainer = document.getElementById('pdfContainer');
            
            database.ref('pdfs').on('value', (snapshot) => {
                pdfContainer.innerHTML = "";

                if (!snapshot.exists()) {
                    pdfContainer.innerHTML = "<p>Nenhum PDF encontrado.</p>";
                    return;
                }

                // Converter para array e ordenar
                const pdfs = [];
                snapshot.forEach(child => {
                    pdfs.push({ id: child.key, ...child.val() });
                });
                pdfs.sort((a, b) => b.timestamp - a.timestamp);

                // Renderizar
                pdfs.forEach(pdf => {
                    const item = document.createElement('div');
                    item.className = 'pdf-item';
                    item.innerHTML = `
                        <div>
                            <h3>${pdf.name}</h3>
                            <small>${new Date(pdf.timestamp).toLocaleString()}</small>
                        </div>
                        <a href="${pdf.url}" target="_blank" download="${pdf.name}">
                            ‚¨áÔ∏è Baixar
                        </a>
                    `;
                    pdfContainer.appendChild(item);
                });

            }, (error) => {
                pdfContainer.innerHTML = "<p>Erro ao carregar PDFs.</p>";
                console.error("Erro no Firebase:", error);
            });
        }

        // Iniciar quando a p√°gina carregar
        window.addEventListener('load', loadPDFs);
    </script>
</body>
</html>
