<!DOCTYPE html>
<html>
<head>
    <title>Biblioteca de PDFs</title>
    <style>
        /* ... (mantenha o estilo anterior) ... */
    </style>
</head>
<body>
    <!-- ... (mantenha o HTML anterior) ... -->

    <script>
        // Substitua com SUAS credenciais!
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "SEU_SENDER_ID",
            appId: "SEU_APP_ID",
            databaseURL: "https://SEU_PROJETO.firebaseio.com" // Formato correto!
        };

        const app = firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const database = firebase.database();

        // Função de Upload (opcional, apenas se quiser testar upload)
        async function uploadPDF() {
            const file = document.getElementById('pdfInput').files[0];
            if (!file) return;

            const status = document.getElementById('status');
            status.textContent = "Enviando...";

            try {
                const storageRef = storage.ref(`pdfs/${Date.now()}_${file.name}`);
                await storageRef.put(file);
                const downloadURL = await storageRef.getDownloadURL();

                await database.ref('pdfs').push({
                    name: file.name,
                    url: downloadURL,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });

                status.textContent = "Upload concluído!";
                document.getElementById('pdfInput').value = "";
            } catch (error) {
                status.textContent = `Erro: ${error.message}`;
                console.error("Erro completo:", error);
            }
        }

        // Função para Carregar PDFs (CRÍTICA)
        function loadPDFs() {
            const pdfContainer = document.getElementById('pdfContainer');
            
            database.ref('pdfs').on('value', (snapshot) => {
                pdfContainer.innerHTML = "";

                if (!snapshot.exists()) {
                    pdfContainer.innerHTML = "<p>Nenhum PDF encontrado.</p>";
                    return;
                }

                // Converter para array e ordenar
                const pdfs = [];
                snapshot.forEach((child) => {
                    const pdf = child.val();
                    if (pdf.url && pdf.name) { // Validação obrigatória!
                        pdfs.push({
                            id: child.key,
                            name: pdf.name,
                            url: pdf.url,
                            timestamp: pdf.timestamp || 0
                        });
                    }
                });

                pdfs.sort((a, b) => b.timestamp - a.timestamp);

                // Renderizar
                pdfs.forEach(pdf => {
                    const div = document.createElement('div');
                    div.className = 'pdf-item';
                    div.innerHTML = `
                        <h3>${pdf.name}</h3>
                        <a href="${pdf.url}" target="_blank" download>⬇️ Baixar</a>
                        <small>${new Date(pdf.timestamp).toLocaleString()}</small>
                    `;
                    pdfContainer.appendChild(div);
                });

            }, (error) => {
                console.error("Erro:", error);
                pdfContainer.innerHTML = `<p>Erro ao carregar: ${error.message}</p>`;
            });
        }

        // Iniciar ao carregar a página
        window.addEventListener('load', loadPDFs);
    </script>
</body>
</html>
