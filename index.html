<!DOCTYPE html>
<html>
<head>
  <title>Chat com Pastas e Arquivos</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-storage-compat.js"></script>
</head>
<body>
  <h1>Sistema de Pastas e Arquivos</h1>
  
  <!-- Criar pastas -->
  <div>
    <input type="text" id="folderName" placeholder="Nome da pasta">
    <button onclick="createFolder()">Criar Pasta</button>
  </div>

  <!-- Upload para pasta -->
  <div>
    <select id="selectedFolder">
      <option value="">Selecione uma pasta</option>
    </select>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Enviar para Pasta</button>
  </div>

  <!-- Listagem de pastas -->
  <div id="foldersList"></div>

  <!-- Chat -->
  <h2>Chat</h2>
  <div id="messages"></div>
  <input type="text" id="messageInput" placeholder="Mensagem">
  <button onclick="sendMessage()">Enviar</button>

  <script>
      const firebaseConfig = {
  apiKey: "AIzaSyDFw39E7f8TQPNlDVKrj5861_FMG_YqCy4",
  authDomain: "finance-ef792.firebaseapp.com",
  databaseURL: "https://finance-ef792-default-rtdb.firebaseio.com",
  projectId: "finance-ef792",
  storageBucket: "finance-ef792.firebasestorage.app",
  messagingSenderId: "67228742612",
  appId: "1:67228742612:web:fa2480d939bda6f18f1c41"
};


    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    // Criar pasta
    function createFolder() {
      const folderName = document.getElementById('folderName').value;
      if (!folderName) return;

      database.ref('folders').push().set({
        name: folderName,
        created: firebase.database.ServerValue.TIMESTAMP
      });
      document.getElementById('folderName').value = '';
    }

    // Upload de arquivo para pasta
    async function uploadFile() {
      const file = document.getElementById('fileInput').files[0];
      const folderId = document.getElementById('selectedFolder').value;
      
      if (!file || !folderId) return;

      // Obter nome da pasta
      const folderRef = database.ref(`folders/${folderId}`);
      const folderSnapshot = await folderRef.once('value');
      const folderName = folderSnapshot.val().name;

      // Fazer upload do arquivo
      const storageRef = storage.ref(`folders/${folderName}/${file.name}`);
      const uploadTask = await storageRef.put(file);
      const downloadURL = await uploadTask.ref.getDownloadURL();

      // Salvar refer√™ncia no banco
      database.ref('files').push().set({
        name: file.name,
        url: downloadURL,
        folder: folderId,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }

    // Enviar mensagem
    function sendMessage() {
      const message = document.getElementById('messageInput').value;
      database.ref('messages').push().set({
        text: message,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
      document.getElementById('messageInput').value = '';
    }

    // Atualizar lista de pastas
    database.ref('folders').on('value', (snapshot) => {
      const select = document.getElementById('selectedFolder');
      const foldersList = document.getElementById('foldersList');
      
      select.innerHTML = '<option value="">Selecione uma pasta</option>';
      foldersList.innerHTML = '';

      snapshot.forEach((child) => {
        // Popular dropdown
        const option = document.createElement('option');
        option.value = child.key;
        option.textContent = child.val().name;
        select.appendChild(option);

        // Listar pastas
        const folderDiv = document.createElement('div');
        folderDiv.innerHTML = `<h3>üìÅ ${child.val().name}</h3>`;
        
        // Listar arquivos da pasta
        database.ref('files').orderByChild('folder').equalTo(child.key).on('value', (fileSnapshot) => {
          folderDiv.innerHTML += '<div style="margin-left: 20px;">';
          fileSnapshot.forEach((fileChild) => {
            const file = fileChild.val();
            folderDiv.innerHTML += `
              <p>
                üìÑ ${file.name} 
                <a href="${file.url}" download style="color: blue;">(Download)</a>
              </p>
            `;
          });
          folderDiv.innerHTML += '</div>';
        });

        foldersList.appendChild(folderDiv);
      });
    });

    // Atualizar chat
    database.ref('messages').on('value', (snapshot) => {
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = '';
      
      snapshot.forEach((child) => {
        const msg = child.val();
        messagesDiv.innerHTML += `<p>üí¨ ${msg.text}</p>`;
      });
    });
  </script>
</body>
</html>
